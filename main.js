// 数字组合对应的信件内容映射
const letterContents = {
    '1226': {
        title: '生日快乐喵！',
        content: `
            <p>致我人生中遇见过最美丽的星星：</p>
            <br>
            <p>时间过得真的很快很快，又多了一岁</p>
            <p>祝黑米粥在新的一岁里多创造自己的辉煌喵！虎鲸期待你的蜕变喵！</p>
            <p>我希望宝宝一直快乐，一直幸福地活下去</p>
            <br>
            <p>借以此言，我会一直陪在你身边，好好爱你</p>
 	   <p>平安喜乐，万事顺意！</p>
        `,
        signature: '小虎鲸'
    },
    '2005': {
        title: '我们可是同龄！',
        content: `
            <p>致最特别的你：</p>
            <br>
            <p>宝宝真聪明喵！想到这个了！</p>
            <p>虎鲸比你大了八个月，虎鲸一定一定会做好年上的职责的！</p>21:16 2025/12/16
            <p>请一直当我的公主殿下好不好qaq</p>
            <p>虎鲸会一直宠你</p>
            <br>
            <p>一直一直</p>
        `,
        signature: '大虎鲸哥哥'
    },
    '5201': {
        title: '我喜欢你',
        content: `
            <p>致我深爱的宝宝·：</p>
            <br>
            <p>说起来有些丢人......</p>
            <p>不知道从什么时候开始，虎鲸自己悄悄陷进去了</p>
            <br>
            <p>或许喜欢就是这种感觉吧？你不在身边的每一秒每分钟都好煎熬好煎熬，止不住去想你再想你</p>
            <p>感谢宝宝选择了我，接纳了我的不完美，虎鲸真的很开心很开心</p>
            <br>
	    <p>虎鲸平日里的时候总喜欢把永远放在嘴边<p>
            <p>我当然没办法设法相信这个世界上有永远</p>
 	    <p>但是在和你相处的每一天，听着宝宝的声音和享受宝宝的爱</p>
            <p>我还是觉得我们一定要永远永远在一起</p>
            <p>因为我想  <br>   用我最初的心，陪你走最远的路</p>
             <br>  
	    <p>我爱你，直到永远</p>
        `,
        signature: '李深源'
    },
    '0000': {
        title: '开发幕后喵',
        content: `
            <p>虎鲸做这个的主意是在十二月十四的那天晚上，虎鲸是一个很注重仪式感的人，对于朋友也好恋人也罢，送出礼物的时候总觉得必须要出一份足够匹得上的心意，虎鲸很喜欢这只黑米粥，所以就想出了这样的一份礼物，这可是独一份！不知道黑米粥是否喜欢，其实也有点害怕啊哈哈？这可是我整过的超级无敌大活！AI真是太好用了你们知道吗！哈哈哈我编了大半天不如问ai几句话，只能说佛物虎鲸是这样的，学了好久的前端开发还是没能精通，就写了这一些简单的小玩意，虎鲸写字特丑，用这个还算是省事的！正在听Ahead of Us 的虎鲸超有干劲是这样</p>	
	     <p>不过很想告诉黑米粥的一件事是，如果黑米粥觉得很亏欠而不知道怎么回礼的时候，其实准备礼物的虎鲸在制造惊喜的时候，已经在脑海里幻想着宝宝无数次惊喜和幸福的模样了，所以不会存在亏欠喵！也不需要什么同等的回报啦！所以请宝宝不要有任何负担！所有的所有只是因为宝宝在我的心目中很珍贵很珍贵，宝宝放开心去享受吧！虎鲸爱你喵！</p> `,
    },
'1025': { title: '坏结局', content: '<p>既然有5201，那为什么没有1025呢？</p><p>这是倒悬的爱意</p><p>这是我钦定的坏结局</p><br><p>你好耀眼</p><p>耀眼到虎鲸觉得自己只是茫茫人海中的过客，就像之前聊到hadew那样：我知道他和我在一起的话根本不可能</p><p>回想起刚认识那一天晚上，虎鲸做了一个好长好长的甜蜜的梦，如同命运捉弄般的相遇，每一次心灰意冷的时候又有新的惊喜出现，虎鲸本来说不上很喜欢，但是被一次次的巧合打动了</p><p>在为虎鲸歌唱的那天晚上，虎鲸觉得这一辈子永远忘不了</p><p>不要......不要离开我 昨天也好明天也罢，虎鲸同样同样真的不想放手，一想到我们的未来总是黑暗</p><p>宝宝身边的人都如此优秀，为什么选择的是我....完全搞不懂，虎鲸找不到被爱的理由，虎鲸从小到大都是一个人孤零零的</p><p>你为什么喜欢我？明明我相比之下完全没有任何优点....随时可以被替换被抛弃，虎鲸害怕，当每次悄悄假装不经意间提及这个的时候，宝宝总是打着哈哈擦过去，虎鲸鼓起勇气说出的那些话在心里拧成了一团</p><p>很抱歉在这个生日礼物里塞了这种烂货，这明明就是烂活嘛！但是虎鲸想了好久还是打算加进来，就算是虎鲸的小情趣吧(?)希望宝宝多了解我一点，我也再离宝宝更进一步......真害怕生日那天挖到这个，算了，让它埋在过去的沙子里，再也出不来</p><p>你要让时间.....怎么转......</p>', signature: '我不会放手的' },
    '1234': {
        content: `
            <p>你输入这个干啥！</p>
            <p>这是彩蛋喵！</p>
            <br>
            <p>如果您能看到这封信，说明：</p>
            <p>√虎鲸和ai共同完成的输入系统工作正常</p>
            <p>✓ 虎鲸做的内容显示功能正常</p>
            <p>✓ 黑米粥已经点进来了</p>
            <br>
            <p>那命令黑米粥  1234爱上我喵！</p>
            <br>
            <p>我ok了，上号！</p>
        `,
        signature: 'AI真是太好用了你们知道吗！~'
    },
    '8888': {
        title: '发发发发发',
        content: `
            <p>给这只幸运的黑米粥：</p>
            <br>
            <p>虎鲸本来对这个数字没什么感觉，但是不得不说当时给出这份前兆生日礼物(马内)的时候，就已经觉得这数字不赖了喵！</p>
            <p>看到这个数字的黑米粥立刻拿出刮刮乐刮中一播完！(虎鲸心虚中)</p>
            <p>那虎鲸只能祝愿宝宝：</p>
            <p>• 学业蒸蒸日上</p>
            <p>• 和我甜甜蜜蜜！</p>
            <p>• 健康平安喜乐</p>
            <p>• 天天赚钱笑哈哈</p>
	    <p>• 天天和虎鲸赚超多哈弗币！</p>
            <br>
            <p>爱笑的女孩子运气不会太差喵！</p>
            <br>
            <p>多笑一下啦！碰到不开心的事情要及时闪开哦！这也算是幸运的一环！</p>
        `,
        signature: '米米哈基米'
    },
'6666': {
 title: '66666666666666',
  content: 
    '<p>666666666666666666666666666666666666666666666666666666666<br>666666666666666666666666666666666666666666</p>' +
    '<br>' +
    '<div class="text-center mt-4">' +
      '<a href="https://www.bilibili.com/video/BV1GJ411x7h7/" ' +
         'target="_blank" ' +
         'class="inline-block px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600">' +
         '点我领取大几几' +
      '</a>' +
    '</div>',
},
  '1314': {
  content: `
    <p>总搜这些干什么！虎鲸是来庆生不是来表白的喵！</p>
    <p>但是虎鲸确实超级喜欢你，不然可不会花这么多时间去搞喵！</p>
    <p></p>
    <p>也许您想找的是：</p>
    <br>
    <p>• 幸福页面 → 输入5201</p>
    <p>• 友情页面 → 输入9213</p>
    <p>• 幸运页面 → 输入8888</p>
    <p>• 其他页面 → 请查看用户手册</p>
    <br>
    <p>虽然这是个错误页面，但我们依然用心为您服务。</p>
    <p>技术问题也能变得有趣，这就是我们的理念。</p>
    <br>
    <p>请尝试其他数字组合，祝您浏览愉快！</p>
  `,
}
};

// DOM元素
const inputs = [
    document.getElementById('digit1'),
    document.getElementById('digit2'),
    document.getElementById('digit3'),
    document.getElementById('digit4')
];
const submitBtn = document.getElementById('submitBtn');
const btnText = document.getElementById('btnText');
const loadingSpinner = document.getElementById('loadingSpinner');
const message = document.getElementById('message');
const hintText = document.getElementById('hintText');

// 初始化动画
document.addEventListener('DOMContentLoaded', function() {
    // 页面加载动画
    anime({
        targets: '.fade-in',
        opacity: [0, 1],
        translateY: [30, 0],
        duration: 800,
        delay: anime.stagger(200),
        easing: 'easeOutQuart'
    });
    
    // 自动聚焦第一个输入框
    setTimeout(() => {
        inputs[0].focus();
    }, 1000);
});

// 输入框事件处理
inputs.forEach((input, index) => {
    // 只允许输入数字
    input.addEventListener('input', function(e) {
        const value = e.target.value;
        if (!/^\d$/.test(value)) {
            e.target.value = '';
            return;
        }
        
        // 输入动画
        anime({
            targets: e.target,
            scale: [1, 1.1, 1],
            duration: 300,
            easing: 'easeOutElastic(1, .6)'
        });
        
        // 自动跳到下一个输入框
        if (value && index < inputs.length - 1) {
            inputs[index + 1].focus();
        }
        
        checkComplete();
    });
    
    // 键盘事件处理
    input.addEventListener('keydown', function(e) {
        if (e.key === 'Backspace' && !e.target.value && index > 0) {
            inputs[index - 1].focus();
            inputs[index - 1].value = '';
        } else if (e.key === 'Enter') {
            checkAndSubmit();
        }
    });
    
    // 聚焦事件
    input.addEventListener('focus', function() {
        anime({
            targets: e.target,
            scale: 1.05,
            duration: 200,
            easing: 'easeOutQuart'
        });
    });
    
    // 失焦事件
    input.addEventListener('blur', function() {
        anime({
            targets: e.target,
            scale: 1,
            duration: 200,
            easing: 'easeOutQuart'
        });
    });
});

// 检查输入是否完成
function checkComplete() {
    const allFilled = inputs.every(input => input.value !== '');
    
    if (allFilled) {
        submitBtn.disabled = false;
        btnText.textContent = '决定了！就是这个！';
        
        // 显示提示
        anime({
            targets: hintText,
            opacity: [0, 1],
            duration: 300
        });
        
        // 按钮动画
        anime({
            targets: submitBtn,
            scale: [1, 1.02, 1],
            duration: 500,
            easing: 'easeOutElastic(1, .6)'
        });
    } else {
        submitBtn.disabled = true;
        btnText.textContent = 'typing~';
        
        // 隐藏提示
        anime({
            targets: hintText,
            opacity: [1, 0],
            duration: 300
        });
    }
}

// 检查并提交
function checkAndSubmit() {
    const code = inputs.map(input => input.value).join('');
    
    if (code.length !== 4) {
        showError('凑够四个啦！');
        return;
    }
    
    if (letterContents[code]) {
        showSuccess();
        setTimeout(() => {
            goToLetter(code);
        }, 1500);
    } else {
        showError('诶嘿，没有提供的义务！');
        shakeInputs();
    }
}

// 显示错误信息
function showError(text) {
    btnText.textContent = text;
    submitBtn.classList.add('bg-red-600', 'hover:bg-red-500');
    submitBtn.classList.remove('bg-stone-800', 'hover:bg-stone-700');
    
    setTimeout(() => {
        btnText.textContent = '让我看看哪个比较顺眼！';
        submitBtn.classList.remove('bg-red-600', 'hover:bg-red-500');
        submitBtn.classList.add('bg-stone-800', 'hover:bg-stone-700');
    }, 2000);
}

// 显示成功状态
function showSuccess() {
    btnText.classList.add('hidden');
    loadingSpinner.classList.remove('hidden');
    submitBtn.classList.add('bg-green-600');
    submitBtn.classList.remove('bg-stone-800');
}

// 输入框震动效果
function shakeInputs() {
    inputs.forEach(input => {
        input.classList.add('error-shake');
        setTimeout(() => {
            input.classList.remove('error-shake');
        }, 500);
    });
    
    // 清空输入
    setTimeout(() => {
        inputs.forEach(input => input.value = '');
        inputs[0].focus();
        checkComplete();
    }, 600);
}

// 跳转到信件页面
function goToLetter(code) {
    // 保存信件内容到localStorage
    localStorage.setItem('currentLetter', JSON.stringify(letterContents[code]));
    localStorage.setItem('letterCode', code);
    
    // 页面跳转动画
    anime({
        targets: 'body',
        opacity: [1, 0],
        duration: 500,
        easing: 'easeInQuart',
        complete: function() {
            window.location.href = 'letter.html';
        }
    });
}

// 提交按钮点击事件
submitBtn.addEventListener('click', checkAndSubmit);